@{
    ViewData["Title"] = "TenantFormDetails";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}
<style>
    .page-heading {
        color: #007bff;
        text-align: center;
        font-weight: bold;
        text-transform: uppercase;
        border-bottom: 2px solid #007bff;
        padding-bottom: 10px;
        margin-bottom: 20px;
        font-family: Arial, sans-serif;
    }

    .form-label {
        font-weight: bold;
    }

    .btn-custom {
        background-color: #007bff;
        color: white;
        border: none;
    }

        .btn-custom:hover {
            background-color: #0056b3;
        }

    .form-container {
        padding: 20px;
        background-color: #f9f9f9;
        border-radius: 8px;
    }
</style>

<!-- Tenant List Table -->
<div class="container mt-4">
    <h3 class="page-heading">Tenant Details</h3>
    <div class="table-responsive">
        <table id="tenantTable1" class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>Organization Id</th>
                    <th>Organization Name</th>
                    <th>Primary Admin Name</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <!-- Sample Data (Dynamically generated in backend) -->
                <tr>
                </tr>

            </tbody>
        </table>
    </div>
</div>
<button id="redirectToTenantRegistration" class="btn btn-primary mt-5">
    Add Tenant 
</button>



<!-- Modal HTML Structure -->
<div class="modal fade" id="tenantModal" tabindex="-1" aria-labelledby="tenantModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="tenantModalLabel">Tenant Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="TenantDetailsForm">
                    <!-- Organization Details -->
                    <div class="mb-3">
                        <label for="organizationName" class="form-label">Organization Name:</label>
                        <input type="text" class="form-control border-0 bg-light" id="modalOrgName" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="organizationName" class="form-label">Organization Type:</label>
                        <input type="text" class="form-control border-0 bg-light" id="modalOrgType" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="organizationName" class="form-label">Organization Capacity:</label>
                        <input type="text" class="form-control border-0 bg-light" id="modalOrgCapacity" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="organizationName" class="form-label">Organization Address:</label>
                        <input type="text" class="form-control border-0 bg-light" id="modalOrgAddress" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="organizationName" class="form-label">Postal Code:</label>
                        <input type="text" class="form-control border-0 bg-light" id="modalOrgCode" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="organizationName" class="form-label">City:</label>
                        <input type="text" class="form-control border-0 bg-light" id="modalOrgCity" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="organizationName" class="form-label">Country:</label>
                        <input type="text" class="form-control border-0 bg-light" id="modalOrgCountry" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="organizationName" class="form-label">Email:</label>
                        <input type="text" class="form-control border-0 bg-light" id="modalOrgEmail" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="organizationName" class="form-label">Mobile:</label>
                        <input type="text" class="form-control border-0 bg-light" id="modalOrgMobile" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="adminName" class="form-label">Admin Name:</label>
                        <input type="text" class="form-control border-0 bg-light" id="modalAdminName" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="organizationName" class="form-label">Admin User-Name:</label>
                        <input type="text" class="form-control border-0 bg-light" id="modalOrgUserName" readonly>
                    </div>
                 
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('redirectToTenantRegistration').addEventListener('click', function() {
        // Redirect to the TenantRegistration action in the SuperAdmin controller
        window.location.href = '/SuperAdmin/TenantRegistration';
    });
</script>
<script>
          $(document).ready(function () {
        getTenantDataDetail();

        
    });

    // Function to fetch acknowledgment data and populate the DataTable
    function getTenantDataDetail() {
        $('#tenantTable1').DataTable({
            destroy: true, // Ensures reloading without duplication
            ajax: {
                url: '/SuperAdmin/GetTenantForm', // API to get acknowledgment forms
                method: 'GET',
                dataSrc: '' // Assuming JSON array response
            },
            columns: [
                { data: 'organizationId' },
                { data: 'organizationName' },
                { data: 'adminName' },
                {
                    data: 'id',
                    render: function (data) {
                        return `
                            <div class="d-flex justify-content-center">
                                <button class="btn btn-info btn-sm mx-1 view-btn" data-id="${data}">
                                    <i class="bi bi-eye"></i> View
                                </button>
                                <button class="btn btn-primary btn-sm mx-1 edit-btn" data-id="${data}">
                                    <i class="bi bi-eye"></i> Edit
                                </button>
                            </div>
                        `;
                    },
                    orderable: false
                }
            ],
            pageLength: 5,
            lengthMenu: [5, 10, 15, 20]
        });

        // Bind click event for dynamically added view button
        $('#tenantTable1 tbody').on('click', '.view-btn', function () {
            const id = $(this).data('id');
            openTenantModalDetail(id);
        });

        // Bind click event for dynamically added "edit" button
        $('#tenantTable1 tbody').on('click', '.edit-btn', function () {
            const id = $(this).data('id');
            editTenantRegistrationDetails(id);
        });
    }


    // Function to handle "Edit" button and pre-fill the registration form
    function editTenantRegistrationDetails(OrganizationId) {
        $.ajax({
            url: '/SuperAdmin/GetTenantRegistrationDetails/' + OrganizationId, // API endpoint to fetch tenant data
            method: 'GET',
            success: function (response) {
                // Log response for debugging
                console.log('Full Response:', response);
               
                if (response.success && response.data.data) {
                    const tenantData = response.data.data;
                   
                    // Construct the URL with the Organization ID to pre-fill the form fields
                    const formPageUrl = `/SuperAdmin/TenantRegistration/${tenantData.id}`;
                    localStorage.setItem('tenantData', JSON.stringify(tenantData));
                    window.location.href = formPageUrl;
                } else {
                    console.error('Error: Invalid or missing data in response.');
                }
               // localStorage.removeItem('tenantData');
            },
            error: function (error) {
                console.error('AJAX Error:', error);
                alert('There was an error processing your request.');
            }
        });
    }
    

    

     // Function to open the modal and load acknowledgment details
    function openTenantModalDetail(tenantID) {
        $.ajax({
            url: `/SuperAdmin/GetTennat/${tenantID}`,
            method: 'GET',
            success: function (response) {
                if (response.success) {

                    const data = response.data.data || response.data;
                    debugger;
                    // Populate modal fields
                    $('#modalOrgName').val(data.orgName || "N/A");
                    $('#modalOrgType').val(data.orgType || "N/A");
                    $('#modalOrgCapacity').val(data.orgCapacity || "N/A");
                    $('#modalOrgAddress').val(data.address || "N/A");
                    $('#modalOrgCode').val(data.postalCode || "N/A");
                    $('#modalOrgCity').val(data.city || "N/A");
                    $('#modalOrgCountry').val(data.country || "N/A");
                    $('#modalOrgEmail').val(data.email || "N/A");
                    $('#modalOrgMobile').val(data.mobile || "N/A");
                    $('#modalAdminName').val(data.primaryAdminName || "N/A");
                    $('#modalOrgUserName').val(data.adminUsername || "N/A");


                    // Show the modal
                    $('#tenantModal').modal('show');
                } else {
                    alert("Error: " + response.message);
                }
            },
            error: function () {
                alert("An error occurred while fetching the data.");
            }
        });
    }
</script>





