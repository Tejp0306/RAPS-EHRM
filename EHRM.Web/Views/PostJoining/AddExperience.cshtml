@model EHRM.ViewModel.MasterEmployee.EmploymentViewModel

@{
    ViewBag.Title = "ExperienceForm";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
<!-- Form Start -->
<form method="post" action="@Url.Action("SavePreviousEmployments", "PostJoining")">
    
    <div id="experienceSection">
        
        <!-- Employment 1 by default -->
        @for (int i = 0; i < 2; i++)
        {
            <input asp-for="PreviousEmployments[i].EmpId" type="hidden" id="EmpId" value="@ViewData["userId"]">
            
            <div class="row mb-3 experience-entry border p-3 rounded shadow-sm">
                <h5 class="text-primary">Previous Employment @(i + 1)</h5>
                <hr />

                <!-- Nature of Employment -->
                <div class="col-md-6 mb-3">
                    <label class="form-label">Nature of Employment</label>
                    <input asp-for="PreviousEmployments[i].NatureOfEmployment" type="text" class="form-control" placeholder="Enter Nature of Employment" required>
                </div>

                <!-- Current Designation -->
                <div class="col-md-6 mb-3">
                    <label class="form-label">Current Designation</label>
                    <input asp-for="PreviousEmployments[i].CurrentDesignation" type="text" class="form-control" placeholder="Enter Designation" required>
                </div>

                <!-- Department / Project Name -->
                <div class="col-md-6 mb-3">
                    <label class="form-label">Department / Project Name</label>
                    <input asp-for="PreviousEmployments[i].Department" type="text" class="form-control" placeholder="Enter Department or Project Name" required>
                </div>

                <!-- Official / Functional Title -->
                <div class="col-md-6 mb-3">
                    <label class="form-label">Official / Functional Title</label>
                    <input asp-for="PreviousEmployments[i].OfficialTitle" type="text" class="form-control" placeholder="Enter Title" required>
                </div>

                <!-- Payroll Company Name -->
                <div class="col-md-6 mb-3">
                    <label class="form-label">Payroll Company Name (as stated on salary slip)</label>
                    <input asp-for="PreviousEmployments[i].PayrollCompanyName" type="text" class="form-control" placeholder="Enter Company Name" required>
                </div>

                <!-- Organization Address -->
                <div class="col-md-6 mb-3">
                    <label class="form-label">Organization Address (Location worked, leave blank if same as Head Office)</label>
                    <textarea asp-for="PreviousEmployments[i].OrganizationAddress" class="form-control" rows="2" placeholder="Enter Address"></textarea>
                </div>

                <!-- From Date -->
                <div class="col-md-6 mb-3">
                    <label class="form-label">From Date</label>
                    <input asp-for="PreviousEmployments[i].FromDate" type="date" class="form-control" required>
                </div>

                <!-- To Date -->
                <div class="col-md-6 mb-3">
                    <label class="form-label">To Date</label>
                    <input asp-for="PreviousEmployments[i].ToDate" type="date" class="form-control" required>
                </div>

                <!-- Employee Code -->
                <div class="col-md-6 mb-3">
                    <label class="form-label">Employee Code</label>
                    <input asp-for="PreviousEmployments[i].EmployeeCode" type="text" class="form-control" placeholder="Enter Employee Code" required>
                </div>

                <!-- CTC Per Annum -->
                <div class="col-md-6 mb-3">
                    <label class="form-label">CTC Per Annum</label>
                    <input asp-for="PreviousEmployments[i].CTCPerAnnum" type="number" class="form-control" placeholder="Enter CTC Per Annum" step="0.01" min="0" required>
                </div>

                <!-- Key Responsibility -->
                <div class="col-md-6 mb-3">
                    <label class="form-label">Key Responsibility</label>
                    <textarea asp-for="PreviousEmployments[i].KeyResponsibility" class="form-control" rows="2" placeholder="Enter Key Responsibilities"></textarea>
                </div>

                <!-- Employment Tenure -->
                <div class="col-md-6 mb-3">
                    <label class="form-label">Employment Tenure</label>
                    <input asp-for="PreviousEmployments[i].EmploymentTenure" type="text" class="form-control" placeholder="Enter Employment Tenure" required>
                </div>

                <!-- Reason for Leaving -->
                <div class="col-md-6 mb-3">
                    <label class="form-label">Reason for Leaving</label>
                    <input asp-for="PreviousEmployments[i].ReasonForLeaving" type="text" class="form-control" placeholder="Enter Reason for Leaving" required>
                </div>

                <!-- Reporting Manager Name -->
                <div class="col-md-6 mb-3">
                    <label class="form-label">Reporting Manager Name</label>
                    <input asp-for="PreviousEmployments[i].ReportingManagerName" type="text" class="form-control" placeholder="Enter Manager Name" required>
                </div>

                <!-- Reporting Manager Designation -->
                <div class="col-md-6 mb-3">
                    <label class="form-label">Reporting Manager Designation</label>
                    <input asp-for="PreviousEmployments[i].ReportingManagerDesignation" type="text" class="form-control" placeholder="Enter Designation" required>
                </div>

                <!-- Is Reporting Manager still part of the company? -->
                <div class="col-md-6 mb-3">
                    <label class="form-label">Is Reporting Manager still part of the company?</label>
                    <select asp-for="PreviousEmployments[i].IsReportingManagerStillInCompany" class="form-control" required>
                        <option value="Yes">Yes</option>
                        <option value="No">No</option>
                    </select>
                </div>

                <!-- Company Landline/ Board line No. -->
                <div class="col-md-6 mb-3">
                    <label class="form-label">Company Landline/ Board line No.</label>
                    <input asp-for="PreviousEmployments[i].CompanyLandline" type="text" class="form-control" placeholder="Enter Landline or Board line No.">
                </div>

                <!-- Personal Mobile No. -->
                <div class="col-md-6 mb-3">
                    <label class="form-label">Personal Mobile No.</label>
                    <input asp-for="PreviousEmployments[i].PersonalMobileNo" type="text" class="form-control" placeholder="Enter Personal Mobile No.">
                </div>

                <!-- Best Time to Reach -->
                <div class="col-md-6 mb-3">
                    <label class="form-label">Best Time to Reach</label>
                    <input asp-for="PreviousEmployments[i].BestTimeToReach" type="text" class="form-control" placeholder="Enter Best Time to Reach" required>
                </div>

                <!-- Remove Button (Only for dynamically added rows) -->
                @if (i > 1)
                {
                    <div class="col-md-12 text-end">
                        <button type="button" class="btn btn-danger remove-experience">Remove</button>
                    </div>
                }
            </div>
        }
    </div>

    <!-- Button to Add More -->
    <div class="text-end mb-3">
        <button type="button" id="addExperienceBtn" class="btn btn-success">Add More Employment</button>
    </div>

    <!-- Submit Button -->
    <div class="text-center mt-4">
        <button type="submit" class="btn btn-primary">Submit</button>
    </div>
</form>
<!-- Form End -->
@section Scripts {
    <script>
        $(document).ready(function () {
            let experienceIndex = 2; // Start after the default 2 entries

            // ✅ Add New Employment Row
            $('#addExperienceBtn').on('click', function () {
                let newRow = `
                <div class="row mb-3 experience-entry border p-3 rounded shadow-sm">
                    <h5 class="text-primary">Previous Employment ${experienceIndex + 1}</h5>
                    <hr />
                    <input name="PreviousEmployments[${experienceIndex}].EmpId" type="hidden" id="EmpId" value="@ViewData["userId"]">
                    <!-- Nature of Employment -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Nature of Employment</label>
                        <input type="text" class="form-control" name="PreviousEmployments[${experienceIndex}].NatureOfEmployment" placeholder="Enter Nature of Employment" required>
                    </div>

                    <!-- Current Designation -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Current Designation</label>
                        <input type="text" class="form-control" name="PreviousEmployments[${experienceIndex}].CurrentDesignation" placeholder="Enter Designation" required>
                    </div>

                    <!-- Department / Project Name -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Department / Project Name</label>
                        <input type="text" class="form-control" name="PreviousEmployments[${experienceIndex}].Department" placeholder="Enter Department or Project Name" required>
                    </div>

                    <!-- Official / Functional Title -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Official / Functional Title</label>
                        <input type="text" class="form-control" name="PreviousEmployments[${experienceIndex}].OfficialTitle" placeholder="Enter Title" required>
                    </div>

                    <!-- Payroll Company Name -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Payroll Company Name (as stated on salary slip)</label>
                        <input type="text" class="form-control" name="PreviousEmployments[${experienceIndex}].PayrollCompanyName" placeholder="Enter Company Name" required>
                    </div>

                    <!-- From Date -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">From Date</label>
                        <input type="date" class="form-control" name="PreviousEmployments[${experienceIndex}].FromDate" required>
                    </div>

                    <!-- To Date -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">To Date</label>
                        <input type="date" class="form-control" name="PreviousEmployments[${experienceIndex}].ToDate" required>
                    </div>

                    <!-- Employee Code -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Employee Code</label>
                        <input type="text" class="form-control" name="PreviousEmployments[${experienceIndex}].EmployeeCode" placeholder="Enter Employee Code" required>
                    </div>

                    <!-- CTC Per Annum -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">CTC Per Annum</label>
                        <input type="number" class="form-control" name="PreviousEmployments[${experienceIndex}].CTCPerAnnum" placeholder="Enter CTC Per Annum" step="0.01" min="0" required>
                    </div>

                    <!-- Reason for Leaving -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Reason for Leaving</label>
                        <input type="text" class="form-control" name="PreviousEmployments[${experienceIndex}].ReasonForLeaving" placeholder="Enter Reason for Leaving" required>
                    </div>

                    <!-- Reporting Manager Name -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Reporting Manager Name</label>
                        <input type="text" class="form-control" name="PreviousEmployments[${experienceIndex}].ReportingManagerName" placeholder="Enter Manager Name" required>
                    </div>

                    <!-- Remove Button -->
                    <div class="col-md-12 text-end">
                        <button type="button" class="btn btn-danger remove-experience">Remove</button>
                    </div>
                </div>`;

                $('#experienceSection').append(newRow);
                experienceIndex++;
            });

            // ✅ Remove Employment Row
            $(document).on('click', '.remove-experience', function () {
                $(this).closest('.experience-entry').remove();
            });
        });
    </script>
}
